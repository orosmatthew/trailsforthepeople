var ctrlGeolocate,isMobile=/Mobi/.test(navigator.userAgent),MARKER_TARGET=new mapboxgl.Marker({color:"#207FD0"}),MARKER_START=new mapboxgl.Marker({color:"#6BB03E"}),MARKER_END=new mapboxgl.Marker({color:"#FF7866"}),SKIP_TO_DIRECTIONS=!1,SETTINGS=[];SETTINGS.coordinate_format="dms";var currentMapLayer="map";function initMap(e){var a,t=e.base||"map";switch(currentMapLayer=t,t){case"photo":case"terrain":a=STYLE_LAYER_CM_SAT;break;case"map":default:a=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:a,clickTolerance:10,center:START_CENTER,zoom:START_ZOOM,maxPitch:60,minPitch:0,preserveDrawingBuffer:!0});var r=new mapboxgl.NavigationControl;MAP.addControl(r,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:0!=e.trackUserLocation}),MAP.addControl(ctrlGeolocate,"bottom-right");var o=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(o,"bottom-left"),e.lat&&e.lng&&e.zoom){var n=parseFloat(e.lat),i=parseFloat(e.lng),s=parseInt(e.zoom);MAP.setCenter([i,n]),MAP.setZoom(s),e.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,i,n))}else MAP.fitBounds(MAX_BOUNDS);"terrain"==t&&MAP.once("style.load",()=>{MAP.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1?optimize=true",tileSize:256,maxzoom:14}),MAP.setTerrain({source:"mapbox-dem",exaggeration:1.25})}),$.event.trigger({type:"mapInitialized"})}function placeMarker(e,a,t){e.setLngLat([t,a]).addTo(MAP)}function clearMarker(e){e.remove()}function showInfoPopup(e,a){switch(a){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(e).addTo(MAP)}function clamp(e,a,t){return Math.min(Math.max(e,a),t)}function changeBasemap(e){switch(currentMapLayer=e,e){case"map":active_layer=STYLE_LAYERS.map;break;case"photo":case"terrain":active_layer=STYLE_LAYERS.photo}MAP.setStyle(active_layer,{diff:!1}),"terrain"==e?MAP.once("style.load",()=>{MAP.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1?optimize=true",tileSize:256,maxzoom:14}),MAP.setTerrain({source:"mapbox-dem",exaggeration:1.25}),MAP.setMaxPitch(60),MAP.setMinPitch(0);let e=MAP.getCenter();IS_TRAILVIEW_ENABLED&&currentTrailViewMarker&&(e=currentTrailViewMarker.getLngLat());let a=MAP.getZoom();a=clamp(a,16,19),setTimeout(()=>{MAP.easeTo({center:e,pitch:60,bearing:MAP.getBearing()+179,zoom:a,easing:e=>1-Math.cos(e*Math.PI/2),duration:3e3}).once("moveend",()=>{MAP.easeTo({bearing:MAP.getBearing()+179,duration:7e3,easing:e=>Math.sin(e*Math.PI/2)})})},500),IS_TRAILVIEW_ENABLED&&updateTrailView()}):MAP.once("style.load",()=>{MAP.setTerrain(null),MAP.stop();let e=MAP.getCenter();IS_TRAILVIEW_ENABLED&&currentTrailViewMarker&&(e=currentTrailViewMarker.getLngLat()),setTimeout(()=>{MAP.easeTo({center:e,pitch:0,duration:500,bearing:0})},500),IS_TRAILVIEW_ENABLED&&updateTrailView()})}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function formatCoords(e,a){switch(format=null!=a?a:SETTINGS.coordinate_format,format){case"ddm":return formatCoordsDdm(e);case"dd":return formatCoordsDd(e);case"dms":default:return formatCoordsDms(e)}}function formatCoordsDms(e,a){a=void 0!==a?a:0;var t=e.lat<0?"S":"N",r=e.lng<0?"W":"E";lat_dd=Math.abs(e.lat),lng_dd=Math.abs(e.lng);var o=parseInt(lat_dd),n=parseInt(60*(lat_dd-o)),i=(3600*(lat_dd-o-n/60)).toFixed(a),s=parseInt(lng_dd),l=parseInt(60*(lng_dd-s)),c=(3600*(lng_dd-s-l/60)).toFixed(a);return coordsStr=o+"째 "+n+"' "+i+'" '+t+", "+s+"째 "+l+"' "+c+'" '+r,coordsStr}function formatCoordsDdm(e,a){a=void 0!==a?a:2;var t=e.lat<0?"S":"N",r=e.lng<0?"W":"E",o=Math.abs(e.lat),n=Math.abs(e.lng),i=parseInt(o),s=(60*(o-i)).toFixed(a),l=parseInt(n),c=(60*(n-l)).toFixed(a);return coordsStr=i+"째 "+s+"' "+t+", "+l+"째 "+c+"' "+r,coordsStr}function formatCoordsDd(e,a){return a=void 0!==a?a:4,coordsStr=e.lat.toFixed(a)+", "+e.lng.toFixed(a),coordsStr}function shortenStr(e,a,t){if(e.length<=a)return e;var r=e.substr(0,e.lastIndexOf(" ",a));return t&&(r+="..."),r}function saveWindowURL(e,a){WINDOW_URL=decodeURIComponent(location.pathname+"?"+e),WINDOW_URL_QUERYSTRING=e.toString(),a?window.history.pushState(null,null,WINDOW_URL):window.history.replaceState(null,null,WINDOW_URL)}function setWindowURLQueryStringParameters(e,a,t){var r;r=a?new URLSearchParams:new URLSearchParams(location.search),$.each(e,(function(e,a){r.set(e,a)})),saveWindowURL(r,t)}