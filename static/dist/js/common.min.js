var ctrlGeolocate,isMobile=/Mobi/.test(navigator.userAgent),MARKER_TARGET=new mapboxgl.Marker({color:"#207FD0"}),MARKER_START=new mapboxgl.Marker({color:"#6BB03E"}),MARKER_END=new mapboxgl.Marker({color:"#FF7866"}),SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(a){var e;switch(a.base||"map"){case"photo":e=STYLE_LAYER_CM_SAT;break;case"map":default:e=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:e,center:START_CENTER,zoom:START_ZOOM,preserveDrawingBuffer:!0});var t=new mapboxgl.NavigationControl;MAP.addControl(t,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:0!=a.trackUserLocation}),MAP.addControl(ctrlGeolocate,"bottom-right");var o=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(o,"bottom-left"),a.lat&&a.lng&&a.zoom){var r=parseFloat(a.lat),n=parseFloat(a.lng),s=parseInt(a.zoom);MAP.setCenter([n,r]),MAP.setZoom(s),a.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,n,r))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function onInitDone(a){a._panViewer.resize(),setInterval(updateNavArrows,13)}function updateNavArrows(){if(TRAILVIEWER){$(".new_nav").each((function(a,e){let t=customMod(360-angle180to360(TRAILVIEWER._panViewer.getYaw())+$(e).data("yaw"),360);$(e).css("transform","rotateZ("+t+"deg) translateY(-50px)")}));let a=(TRAILVIEWER._panViewer.getPitch()+90)/2;a>80?a=80:a<0&&(a=0),$("#nav_container").css("transform","perspective(300px) rotateX("+a+"deg)")}}function onNavArrowClicked(a){TRAILVIEWER.goToImageID(a)}function populateArrows(a){if(currentHotspots=a,$(".new_nav").remove(),a){for(let e=0;e<a.length;e++){let t=document.createElement("img");$(t).addClass("new_nav"),$(t).addClass("new_nav-small"),$(t).attr("src","https://trailview.cmparks.net/assets/images/ui/arrow_new_small_white.png"),$(t).data("yaw",a[e].yaw),$(t).data("id",a[e].clickHandlerArgs.id),$(t).hide(0),$(t).on("click",(function(a){a.preventDefault(),onNavArrowClicked($(this).data("id")),$(".new_nav").fadeOut(10)})),$(t).attr("draggable",!1),$("#nav_container").append($(t))}updateNavArrows(),$(".new_nav").fadeIn(200)}}function initViewer(){TRAILVIEWER=new TrailViewer({useURLHashing:!1,onInitDoneFunc:onInitDone,onArrowsAddedFunc:populateArrows,navArrowMinAngle:-25,navArrowMaxAngle:-20},"56aefc085da0466a8bb4139c4515cd0c",null)}function placeMarker(a,e,t){a.setLngLat([t,e]).addTo(MAP)}function clearMarker(a){a.remove()}function showInfoPopup(a,e){switch(e){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(a).addTo(MAP)}function changeBasemap(a){active_layer=STYLE_LAYERS[a],MAP.setStyle(active_layer)}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function formatCoords(a,e){switch(format=null!=e?e:SETTINGS.coordinate_format,format){case"ddm":return formatCoordsDdm(a);case"dd":return formatCoordsDd(a);case"dms":default:return formatCoordsDms(a)}}function formatCoordsDms(a,e){e=void 0!==e?e:0;var t=a.lat<0?"S":"N",o=a.lng<0?"W":"E";lat_dd=Math.abs(a.lat),lng_dd=Math.abs(a.lng);var r=parseInt(lat_dd),n=parseInt(60*(lat_dd-r)),s=(3600*(lat_dd-r-n/60)).toFixed(e),l=parseInt(lng_dd),i=parseInt(60*(lng_dd-l)),d=(3600*(lng_dd-l-i/60)).toFixed(e);return coordsStr=r+"째 "+n+"' "+s+'" '+t+", "+l+"째 "+i+"' "+d+'" '+o,coordsStr}function formatCoordsDdm(a,e){e=void 0!==e?e:2;var t=a.lat<0?"S":"N",o=a.lng<0?"W":"E",r=Math.abs(a.lat),n=Math.abs(a.lng),s=parseInt(r),l=(60*(r-s)).toFixed(e),i=parseInt(n),d=(60*(n-i)).toFixed(e);return coordsStr=s+"째 "+l+"' "+t+", "+i+"째 "+d+"' "+o,coordsStr}function formatCoordsDd(a,e){return e=void 0!==e?e:4,coordsStr=a.lat.toFixed(e)+", "+a.lng.toFixed(e),coordsStr}function shortenStr(a,e,t){if(a.length<=e)return a;var o=a.substr(0,a.lastIndexOf(" ",e));return t&&(o+="..."),o}function saveWindowURL(a,e){WINDOW_URL=decodeURIComponent(location.pathname+"?"+a),WINDOW_URL_QUERYSTRING=a.toString(),e?window.history.pushState(null,null,WINDOW_URL):window.history.replaceState(null,null,WINDOW_URL)}function setWindowURLQueryStringParameters(a,e,t){var o;o=e?new URLSearchParams:new URLSearchParams(location.search),$.each(a,(function(a,e){o.set(a,e)})),saveWindowURL(o,t)}SETTINGS.coordinate_format="dms";